
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>WebRTC03入门教程01 | 炫杉</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ixsim">
    

    
    <meta name="description" content="WebRTC教程">
<meta name="keywords" content="tutorial">
<meta property="og:type" content="article">
<meta property="og:title" content="WebRTC03入门教程01">
<meta property="og:url" content="https://ixsim.github.io/WebRTC/WebRTC03入门教程01/index.html">
<meta property="og:site_name" content="炫杉">
<meta property="og:description" content="WebRTC教程">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.tutorialspoint.com/webrtc/images/architecture.jpg">
<meta property="og:image" content="https://ixsim.github.io/var/folders/r1/fl4npcxs78q5kh714tg987wm0000gn/T/abnerworks.Typora/image-20180829102518714.png">
<meta property="og:updated_time" content="2018-09-03T07:33:39.899Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebRTC03入门教程01">
<meta name="twitter:description" content="WebRTC教程">
<meta name="twitter:image" content="https://www.tutorialspoint.com/webrtc/images/architecture.jpg">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="炫杉" title="炫杉"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="炫杉">炫杉</a></h1>
				<h2 class="blog-motto">提着鸟笼的老头站在一旁拍我肩膀 我猜他想的应该和我一样</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:ixsim.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/WebRTC/WebRTC03入门教程01/" title="WebRTC03入门教程01" itemprop="url">WebRTC03入门教程01</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ixsim" target="_blank" itemprop="author">ixsim</a>
		
  <p class="article-time">
    <time datetime="2018-08-27T01:23:39.000Z" itemprop="datePublished"> 发表于 2018-08-27</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Home"><span class="toc-number">1.</span> <span class="toc-text">Home</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#概览"><span class="toc-number">2.</span> <span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本格局"><span class="toc-number">2.1.</span> <span class="toc-text">基本格局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#浏览器兼容"><span class="toc-number">2.2.</span> <span class="toc-text">浏览器兼容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用场景"><span class="toc-number">2.3.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#结构体系"><span class="toc-number">3.</span> <span class="toc-text">结构体系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebRTC-API"><span class="toc-number">3.1.</span> <span class="toc-text">WebRTC API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#环境"><span class="toc-number">4.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MediaStream-APIs"><span class="toc-number">5.</span> <span class="toc-text">MediaStream APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-number">5.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API"><span class="toc-number">5.2.</span> <span class="toc-text">API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性"><span class="toc-number">5.2.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件句柄"><span class="toc-number">5.2.2.</span> <span class="toc-text">事件句柄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法"><span class="toc-number">5.2.3.</span> <span class="toc-text">方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RTCDataChannel-APIs"><span class="toc-number">6.</span> <span class="toc-text">RTCDataChannel APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RTCDataChannel-API"><span class="toc-number">6.1.</span> <span class="toc-text">RTCDataChannel API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-1"><span class="toc-number">6.1.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Handlers"><span class="toc-number">6.1.2.</span> <span class="toc-text">Event Handlers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Methods"><span class="toc-number">6.1.3.</span> <span class="toc-text">Methods</span></a></li></ol></li></ol></li></ol>
		
		</div>
		
		<p><a href="https://www.tutorialspoint.com/webrtc/index.htm" target="_blank" rel="noopener">WebRTC教程</a></p>
<a id="more"></a>
<h1 id="Home"><a href="#Home" class="headerlink" title="Home"></a>Home</h1><p>WebRTC（网页实时通讯）技术可以很容易地让人们在网页实现音频、视频连接。这个教程中，我们会解释如何用WebRTC快速建立一个peer-to-peer的连接。</p>
<p><strong>受众</strong><br>开发者。<br><strong>条件</strong><br>WebRTC用于赋予浏览器和移动App实时通信的能力。</p>
<h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><p>尽管WebRTC发布于2011年5月，但它至今仍在发展和改进。<br><strong>IETF (Internet Engineering Task Force)</strong>网页浏览器组在RTC做了一系列协议的标准化。<br><a href="http://tools.ietf.org/wg/rtcweb/" target="_blank" rel="noopener">http://tools.ietf.org/wg/rtcweb/</a><br><strong>W3C (World Wide Web Consortium)</strong>在APIs上做了标准化。<br><a href="http://www.w3.org/2011/04/webrtc/" target="_blank" rel="noopener">http://www.w3.org/2011/04/webrtc/</a></p>
<h2 id="基本格局"><a href="#基本格局" class="headerlink" title="基本格局"></a>基本格局</h2><p>WebRTC可以让你快速建立p2p连接。你需要有框架和一些能力来处理一些典型的问题比如，数据丢失，连接中断和NAT跨越。这在都在<a href="http://www.webrtc.org/的开源资源中。" target="_blank" rel="noopener">http://www.webrtc.org/的开源资源中。</a></p>
<p><code>WebRTC应用</code> –&gt; <code>WebRTC API</code> <code>媒体捕捉</code> <code>编码解码音视频</code> <code>传输层</code> <code>节点管理</code> </p>
<p>WebRTC的API包括 </p>
<ul>
<li><p>媒体捕捉</p>
</li>
<li><p>编码解码音视频</p>
<p>这种算法叫做<strong>codec</strong>，有很多很多，这些<strong>codecs</strong>由不同的公司在维护用于不同的商业目的。WebRTC中有几种<strong>codec</strong>比如H.264,iSAC,Opus和VP8。当两个浏览器连接起来，他们为用户选择最匹配最合适的<strong>codec</strong>。</p>
</li>
<li><p>传输层</p>
<p>管理包的顺序。处理丢包。连接用户。</p>
</li>
<li><p>节点管理</p>
<p>管理，打开，阻止连接。</p>
</li>
</ul>
<h2 id="浏览器兼容"><a href="#浏览器兼容" class="headerlink" title="浏览器兼容"></a>浏览器兼容</h2><p>在这里检测</p>
<p><a href="https://caniuse.com/#feat=rtcpeerconnection" target="_blank" rel="noopener">https://caniuse.com/#feat=rtcpeerconnection</a></p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>实时交易</li>
<li>实时广告</li>
<li>下班后交流</li>
<li>HR管理</li>
<li>社交网络</li>
<li>数据服务</li>
<li>在线医疗</li>
<li>金融服务</li>
<li>监视</li>
<li>多人游戏</li>
<li>在线广播</li>
<li>在线教育</li>
</ul>
<h1 id="结构体系"><a href="#结构体系" class="headerlink" title="结构体系"></a>结构体系</h1><p><img src="https://www.tutorialspoint.com/webrtc/images/architecture.jpg" alt=""></p>
<p>三个不同层：</p>
<ul>
<li>web开发者API</li>
<li>浏览器厂家API</li>
<li>浏览器厂家可以hook的可覆盖的API</li>
</ul>
<h2 id="WebRTC-API"><a href="#WebRTC-API" class="headerlink" title="WebRTC API"></a>WebRTC API</h2><p>包括一些主要的js对象</p>
<ul>
<li><p>RTCPeerConnection</p>
<p>建立连接用的</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> conn = <span class="keyword">new</span> RTCPeerConnection(conf); </span><br><span class="line">conn.onaddstream = <span class="function"><span class="keyword">function</span>(<span class="params">stream</span>) </span>&#123; </span><br><span class="line">   <span class="comment">// use stream here </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>MediaStream</p>
<p>音视频处理</p>
<p>例子：</p>
<p>创建一个HTML网页：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span> = <span class="string">"utf-8"</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">	 </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再加一个<code>client.js</code>文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//checks if the browser supports WebRTC </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasUserMedia</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia </span><br><span class="line">      || navigator.mozGetUserMedia || navigator.msGetUserMedia; </span><br><span class="line">   <span class="keyword">return</span> !!navigator.getUserMedia; </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (hasUserMedia()) &#123; </span><br><span class="line">   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia</span><br><span class="line">      || navigator.mozGetUserMedia || navigator.msGetUserMedia;</span><br><span class="line">		</span><br><span class="line">   <span class="comment">//get both video and audio streams from user's camera </span></span><br><span class="line">   navigator.getUserMedia(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">var</span> video = <span class="built_in">document</span>.querySelector(<span class="string">'video'</span>); </span><br><span class="line">		</span><br><span class="line">      <span class="comment">//insert stream into the video tag </span></span><br><span class="line">      video.src = <span class="built_in">window</span>.URL.createObjectURL(stream); </span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;&#125;); </span><br><span class="line">	</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   alert(<span class="string">"Error. WebRTC is not supported!"</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后打开那个HTML网页就能看到你自己啦~</p>
</li>
<li><p>RTCDataChannel</p>
<p>通过RTCPeerConnection对象来创建信道</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> peerConn = <span class="keyword">new</span> RTCPeerConnection(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//establishing peer connection </span></span><br><span class="line"><span class="comment">//... </span></span><br><span class="line"><span class="comment">//end of establishing peer connection </span></span><br><span class="line"><span class="keyword">var</span> dataChannel = peerConnection.createDataChannel(<span class="string">"myChannel"</span>, dataChannelOptions); </span><br><span class="line"></span><br><span class="line"><span class="comment">// here we can start sending direct messages to another peer</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>这里作者用的就是 HTML+JS+Node.js</p>
<p>安装好后。在终端输入 <code>node</code>测试nodejs工作了。</p>
<p>然后用Node.js的WebSockets库来搭建信令服务器。</p>
<p><code>npm install ws</code>安装WebSocket</p>
<p>为了测试信令服务器，<code>npm install -g wscat</code>安装wscat.</p>
<table>
<thead>
<tr>
<th>S.No</th>
<th>Protocols &amp; Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_protocols.htm" target="_blank" rel="noopener">WebRTC Protocols</a>WebRTC applications use UDP (User Datagram Protocol) as the transport protocol. Most web applications today are built with the using of the TCP (Transmission Control Protocol)</td>
</tr>
<tr>
<td>2</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_session_description_protocol.htm" target="_blank" rel="noopener">Session Description Protocol</a>The SDP is an important part of the WebRTC. It is a protocol that is intended to describe media communication sessions.</td>
</tr>
<tr>
<td>3</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_finding_route.htm" target="_blank" rel="noopener">Finding a Route</a>In order to connect to another user, you should find a clear path around your own network and the other user’s network. But there are chances that the network you are using has several levels of access control to avoid security issues.</td>
</tr>
<tr>
<td>4</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_sctp.htm" target="_blank" rel="noopener">Stream Control Transmission Protocol</a>With the peer connection, we have the ability to send quickly video and audio data. The SCTP protocol is used today to send blob data on top of our currently setup peer connection when using the RTCDataChannel object.</td>
</tr>
</tbody>
</table>
<h1 id="MediaStream-APIs"><a href="#MediaStream-APIs" class="headerlink" title="MediaStream APIs"></a>MediaStream APIs</h1><p>这个API用于轻松从本地的摄像头麦克风获取流媒体。<code>getUserMedia()</code>方法是最常用的。</p>
<p>关键点：</p>
<ul>
<li>一个流对象（音频/视频）呈现一个实时媒体</li>
<li>在抓取这些媒体流之前，会询问用户的授权</li>
<li>输入设备的选择是可用API规定的。</li>
</ul>
<p>每个MediaSteam对象包含多个MediaSteamTrack对象。他们展示不同输入设备输入进来的音频、视频。</p>
<p>每个MediaSteamTrack对象可能包含多个频道（左/右声道）。</p>
<hr>
<p>输出MediaSteam对象有两种方法，1，输出到一个video或audio元素中。2，发送输出给RTCpeerConnection对象，它可以再发送给更远的peer。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>又举了一遍上面举过的html+client.js的例子。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><strong>MediaStream.active(read only)</strong> 如果激活了返回true</li>
<li><strong>MediaSteam.ended(read only,deprecated)</strong> 如果流没有到达，返回<u>false</u>；如果事件对象已经被解除（说明流已经被读完），返回<u>true</u></li>
<li><strong>MediaSteam.id(read only)</strong>对象的唯一id</li>
<li><strong>MediaSteam.label(read only, deprecated)</strong>  根据用户代理分配的唯一标识<br>你可以在浏览器中console查看这些特性</li>
</ul>
<p><img src="../../../../../../../var/folders/r1/fl4npcxs78q5kh714tg987wm0000gn/T/abnerworks.Typora/image-20180829102518714.png" alt="image-20180829102518714"></p>
<h3 id="事件句柄"><a href="#事件句柄" class="headerlink" title="事件句柄"></a>事件句柄</h3><ul>
<li><strong>MediaStream.onactive</strong> −  一个MediaStream 对象变成激活的<em>active</em> 事件的句柄 </li>
<li><strong>MediaStream.onaddtrack</strong> − 添加了新的<em> </em>MediaStreamTrack* 对象后的句柄</li>
<li><strong>MediaStream.onended (deprecated)</strong> − 结束并解除的句柄</li>
<li><strong>MediaStream.oninactive</strong> − 一个 <em>MediaStream</em>对象变成激活状态后的 <em>inactive</em> 时间句柄</li>
<li><strong>MediaStream.onremovetrack</strong> −  一个 <em>MediaStreamTrack</em> 对象被激活后的 <em>removetrack</em>事件句柄</li>
</ul>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ul>
<li><strong>MediaStream.addTrack()</strong> − 添加 <em>MediaStreamTrack</em> 对象到MediaStream. 如果这个Track已经添加则什么都不做。</li>
<li><strong>MediaStream.clone()</strong> − 返回一个有新ID的MediaStream对象。</li>
<li><strong>MediaStream.getAudioTracks()</strong> − 从<em>MediaStream</em> 对象中返回一个list音频 <em>MediaStreamTrack</em> 对象 </li>
<li><strong>MediaStream.getVideoTracks()</strong> − 类比上一个</li>
<li><strong>MediaStream.getTrackById()</strong> − 返回trackID。 如果argument为空返回null。如果多个tracks ID相同返回第一个。</li>
<li><strong>MediaStream.getTracks()</strong> − 返回一个 <em>MediaStream</em>对象的所有 <em>MediaStreamTrack</em>对象</li>
<li><strong>MediaStream.removeTrack()</strong> − 从MediaSteam中移除 <em>MediaStreamTrack</em>对象。如果这个track已经被移除则什么也不做</li>
</ul>
<p>例子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span> = <span class="string">"en"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span> = <span class="string">"utf-8"</span> /&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetAudioTracks"</span>&gt;</span>getAudioTracks()</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetTrackById"</span>&gt;</span>getTrackById()</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetTracks"</span>&gt;</span>getTracks()<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetVideoTracks"</span>&gt;</span>getVideoTracks()</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnRemoveAudioTrack"</span>&gt;</span>removeTrack() - audio</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnRemoveVideoTrack"</span>&gt;</span>removeTrack() - video</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stream;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasUserMedia</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">   <span class="comment">//check if the browser supports the WebRTC </span></span><br><span class="line">   <span class="keyword">return</span> !!(navigator.getUserMedia || navigator.webkitGetUserMedia || </span><br><span class="line">      navigator.mozGetUserMedia); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (hasUserMedia()) &#123;</span><br><span class="line">   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia</span><br><span class="line">      || navigator.mozGetUserMedia; </span><br><span class="line">		</span><br><span class="line">   <span class="comment">//enabling video and audio channels </span></span><br><span class="line">   navigator.getUserMedia(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123; </span><br><span class="line">      stream = s; </span><br><span class="line">      <span class="keyword">var</span> video = <span class="built_in">document</span>.querySelector(<span class="string">'video'</span>); </span><br><span class="line">		</span><br><span class="line">      <span class="comment">//inserting our stream to the video tag     </span></span><br><span class="line">      video.src = <span class="built_in">window</span>.URL.createObjectURL(stream); </span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;&#125;); </span><br><span class="line">	</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">   alert(<span class="string">"WebRTC is not supported"</span>); </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">btnGetAudioTracks.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getAudioTracks"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getAudioTracks()); </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">btnGetTrackById.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getTrackById"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getTrackById(stream.getAudioTracks()[<span class="number">0</span>].id)); </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">btnGetTracks.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getTracks()"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getTracks()); </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">btnGetVideoTracks.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getVideoTracks()"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getVideoTracks()); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">btnRemoveAudioTrack.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"removeAudioTrack()"</span>); </span><br><span class="line">   stream.removeTrack(stream.getAudioTracks()[<span class="number">0</span>]); </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">btnRemoveVideoTrack.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"removeVideoTrack()"</span>); </span><br><span class="line">   stream.removeTrack(stream.getVideoTracks()[<span class="number">0</span>]); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="RTCDataChannel-APIs"><a href="#RTCDataChannel-APIs" class="headerlink" title="RTCDataChannel APIs"></a>RTCDataChannel APIs</h1><p>WebRTC不仅擅长发送音频和视频，还可能是任意数据。这就是RTCDataChannel对象的功能。</p>
<h2 id="RTCDataChannel-API"><a href="#RTCDataChannel-API" class="headerlink" title="RTCDataChannel API"></a>RTCDataChannel API</h2><h3 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h3><ul>
<li><p><strong>RTCDataChannel.label (read only)</strong> − 返回一个数据信道名的字符串</p>
</li>
<li><p><strong>RTCDataChannel.ordered (read only)</strong> − 如果消息投递顺序有保障返回true。没保证返回false。</p>
</li>
<li><p><strong>RTCDataChannel.protocol (read only)</strong> −返回这个信道使用的子协议名的字符串。</p>
</li>
<li><p><strong>RTCDataChannel.id (read only)</strong> − 返回RTCDataChannel对象创建时的唯一id</p>
</li>
<li><p><strong>RTCDataChannel.readyState (read only)</strong> − 返回 RTCDataChannelState enum描述连接状态。</p>
<p>可能的值：</p>
<ul>
<li><strong>connecting</strong> − 候选的连接还没有激活. 这是初始化状态.</li>
<li><strong>open</strong> − 候选的连接正在运行.</li>
<li><strong>closing</strong> − Indicates that the connection正在关闭ing. The cached messages are in the process of being sent or received, but no newly created task is accepting.</li>
<li><strong>closed</strong> − Indicates that the connection could not be established or has been shut down.</li>
</ul>
</li>
<li><p><strong>RTCDataChannel.bufferedAmount (read only)</strong> − Returns the amount of bytes that have been queued for sending. This is the amount of data that has not been sent yet via RTCDataChannel.send().</p>
</li>
<li><p><strong>RTCDataChannel.bufferedAmountLowThreshold</strong> − Returns the number of bytes at which the RTCDataChannel.bufferedAmount is taken up as low. When the RTCDataChannel.bufferedAmount decreases below this threshold, the bufferedamountlow event is fired.</p>
</li>
<li><p><strong>RTCDataChannel.binaryType</strong> − Returns the type of the binary data transmitted by the connection. Can be “blob” or “arraybuffer”.</p>
</li>
<li><p><strong>RTCDataChannel.maxPacketLifeType (read only)</strong> − Returns an unsigned short that indicates the length in milliseconds of the window in when messaging is going in unreliable mode.</p>
</li>
<li><p><strong>RTCDataChannel.maxRetransmits (read only)</strong> − Returns an unsigned short that indicates the maximum number of times a channel will retransmit data if it is not delivered.</p>
</li>
<li><p><strong>RTCDataChannel.negotiated (read only)</strong> − Returns a boolean that indicates if the channel has been negotiated by the user-agent, or by the application.</p>
</li>
<li><p><strong>RTCDataChannel.reliable (read only)</strong> − Returns a boolean that indicates of the connection can send messages in unreliable mode.</p>
</li>
<li><p><strong>RTCDataChannel.stream (read only)</strong> − Synonym for RTCDataChannel.id</p>
</li>
</ul>
<h3 id="Event-Handlers"><a href="#Event-Handlers" class="headerlink" title="Event Handlers"></a>Event Handlers</h3><ul>
<li><strong>RTCDataChannel.onopen</strong> − This event handler is called when the open event is fired. This event is sent when the data connection has been established.</li>
<li><strong>RTCDataChannel.onmessage</strong> − This event handler is called when the message event is fired. The event is sent when a message is available on the data channel.</li>
<li><strong>RTCDataChannel.onbufferedamountlow</strong> − This event handler is called when the bufferedamoutlow event is fired. This event is sent when RTCDataChannel.bufferedAmount decreases below the RTCDataChannel.bufferedAmountLowThreshold property.</li>
<li><strong>RTCDataChannel.onclose</strong> − This event handler is called when the close event is fired. This event is sent when the data connection has been closed.</li>
<li><strong>RTCDataChannel.onerror</strong> − This event handler is called when the error event is fired. This event is sent when an error has been encountered.</li>
</ul>
<h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul>
<li><strong>RTCDataChannel.close()</strong> − Closes the data channel.</li>
<li><strong>RTCDataChannel.send()</strong> − Sends the data in the parameter over the channel. The data can be a blob, a string, an ArrayBuffer or an ArrayBufferView.</li>
</ul>
<p>未完。</p>
<center>翻译自<a href="https://www.tutorialspoint.com/webrtc/index.htm没有全文翻译。侵权删。" target="_blank" rel="noopener">https://www.tutorialspoint.com/webrtc/index.htm没有全文翻译。侵权删。</a></center>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/WebRTC/">WebRTC</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/tutorial/">tutorial</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://ixsim.github.io/WebRTC/WebRTC03入门教程01/" data-title="WebRTC03入门教程01 | 炫杉" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/WebRTC/WebRTC04Kurento流程分析/" title="WebRTC04KurentoDemo流程分析">
  <strong>上一篇：</strong><br/>
  <span>
  WebRTC04KurentoDemo流程分析</span>
</a>
</div>


<div class="next">
<a href="/WebRTC/WebRTC02查资料/"  title="WebRTC02查基础资料">
 <strong>下一篇：</strong><br/> 
 <span>WebRTC02查基础资料
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Home"><span class="toc-number">1.</span> <span class="toc-text">Home</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#概览"><span class="toc-number">2.</span> <span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本格局"><span class="toc-number">2.1.</span> <span class="toc-text">基本格局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#浏览器兼容"><span class="toc-number">2.2.</span> <span class="toc-text">浏览器兼容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用场景"><span class="toc-number">2.3.</span> <span class="toc-text">使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#结构体系"><span class="toc-number">3.</span> <span class="toc-text">结构体系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#WebRTC-API"><span class="toc-number">3.1.</span> <span class="toc-text">WebRTC API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#环境"><span class="toc-number">4.</span> <span class="toc-text">环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MediaStream-APIs"><span class="toc-number">5.</span> <span class="toc-text">MediaStream APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-number">5.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API"><span class="toc-number">5.2.</span> <span class="toc-text">API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性"><span class="toc-number">5.2.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件句柄"><span class="toc-number">5.2.2.</span> <span class="toc-text">事件句柄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法"><span class="toc-number">5.2.3.</span> <span class="toc-text">方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RTCDataChannel-APIs"><span class="toc-number">6.</span> <span class="toc-text">RTCDataChannel APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RTCDataChannel-API"><span class="toc-number">6.1.</span> <span class="toc-text">RTCDataChannel API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性-1"><span class="toc-number">6.1.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Event-Handlers"><span class="toc-number">6.1.2.</span> <span class="toc-text">Event Handlers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Methods"><span class="toc-number">6.1.3.</span> <span class="toc-text">Methods</span></a></li></ol></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Blockchain/" title="Blockchain">Blockchain<sup>1</sup></a></li>
		  
		
		  
		
		  
		
		  
			<li><a href="/categories/Others/" title="Others">Others<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/WebRTC/" title="WebRTC">WebRTC<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/Website/" title="Website">Website<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>10</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Note/" title="Note">Note<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/Swift/" title="Swift">Swift<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Demo/" title="Demo">Demo<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/LeetCode/" title="LeetCode">LeetCode<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/tips/" title="tips">tips<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tutorial/" title="tutorial">tutorial<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/js/" title="js">js<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Spider/" title="Spider">Spider<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C++">C++<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Data-Analysis/" title="Data Analysis">Data Analysis<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Matlab/" title="Matlab">Matlab<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Swfit/" title="Swfit">Swfit<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/File-Process/" title="File Process">File Process<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/note/" title="note">note<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/IoT/" title="IoT">IoT<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/selenium/" title="selenium">selenium<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://oo1.win" target="_blank" title="炫猿">炫猿</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.aimoon.site/" target="_blank" title="我大哥">我大哥</a>
            
          </li>
        
          <li>
            
            	<a href="https://onebigcabbage.github.io/" target="_blank" title="小菜哥">小菜哥</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, <br/>
			World!</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/lixsh" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:xuanshanli@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="ixsim">ixsim</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'oo1';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>








<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
