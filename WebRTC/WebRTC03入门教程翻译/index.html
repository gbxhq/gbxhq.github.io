<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="WebRTC教程">
<meta name="keywords" content="tutorial">
<meta property="og:type" content="article">
<meta property="og:title" content="WebRTC03入门教程01">
<meta property="og:url" content="https://ixsim.github.io/WebRTC/WebRTC03入门教程翻译/index.html">
<meta property="og:site_name" content="炫杉">
<meta property="og:description" content="WebRTC教程">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.tutorialspoint.com/webrtc/images/architecture.jpg">
<meta property="og:image" content="https://ixsim.github.io/var/folders/r1/fl4npcxs78q5kh714tg987wm0000gn/T/abnerworks.Typora/image-20180829102518714.png">
<meta property="og:updated_time" content="2018-08-31T03:19:58.136Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebRTC03入门教程01">
<meta name="twitter:description" content="WebRTC教程">
<meta name="twitter:image" content="https://www.tutorialspoint.com/webrtc/images/architecture.jpg">






  <link rel="canonical" href="https://ixsim.github.io/WebRTC/WebRTC03入门教程翻译/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>WebRTC03入门教程01 | 炫杉</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">炫杉</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">提着鸟笼的老头站在一旁拍我肩膀 我猜他想的应该和我一样</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-我的书签">
    <a href="/oo1" rel="section">
      <i class="menu-item-icon fa fa-fw fa-bookmark"></i> <br />我的书签</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ixsim.github.io/WebRTC/WebRTC03入门教程翻译/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ixsim">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="炫杉">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">WebRTC03入门教程01
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-08-27 09:23:39" itemprop="dateCreated datePublished" datetime="2018-08-27T09:23:39+08:00">2018-08-27</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/WebRTC/" itemprop="url" rel="index"><span itemprop="name">WebRTC</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/WebRTC/WebRTC03入门教程翻译/" class="leancloud_visitors" data-flag-title="WebRTC03入门教程01">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://www.tutorialspoint.com/webrtc/index.htm" target="_blank" rel="noopener">WebRTC教程</a></p>
<a id="more"></a>
<h1 id="Home"><a href="#Home" class="headerlink" title="Home"></a>Home</h1><p>WebRTC（网页实时通讯）技术可以很容易地让人们在网页实现音频、视频连接。这个教程中，我们会解释如何用WebRTC快速建立一个peer-to-peer的连接。</p>
<p><strong>受众</strong><br>开发者。<br><strong>条件</strong><br>WebRTC用于赋予浏览器和移动App实时通信的能力。</p>
<h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><p>尽管WebRTC发布于2011年5月，但它至今仍在发展和改进。<br><strong>IETF (Internet Engineering Task Force)</strong>网页浏览器组在RTC做了一系列协议的标准化。<br><a href="http://tools.ietf.org/wg/rtcweb/" target="_blank" rel="noopener">http://tools.ietf.org/wg/rtcweb/</a><br><strong>W3C (World Wide Web Consortium)</strong>在APIs上做了标准化。<br><a href="http://www.w3.org/2011/04/webrtc/" target="_blank" rel="noopener">http://www.w3.org/2011/04/webrtc/</a></p>
<h2 id="基本格局"><a href="#基本格局" class="headerlink" title="基本格局"></a>基本格局</h2><p>WebRTC可以让你快速建立p2p连接。你需要有框架和一些能力来处理一些典型的问题比如，数据丢失，连接中断和NAT跨越。这在都在<a href="http://www.webrtc.org/的开源资源中。" target="_blank" rel="noopener">http://www.webrtc.org/的开源资源中。</a></p>
<p><code>WebRTC应用</code> –&gt; <code>WebRTC API</code> <code>媒体捕捉</code> <code>编码解码音视频</code> <code>传输层</code> <code>节点管理</code> </p>
<p>WebRTC的API包括 </p>
<ul>
<li><p>媒体捕捉</p>
</li>
<li><p>编码解码音视频</p>
<p>这种算法叫做<strong>codec</strong>，有很多很多，这些<strong>codecs</strong>由不同的公司在维护用于不同的商业目的。WebRTC中有几种<strong>codec</strong>比如H.264,iSAC,Opus和VP8。当两个浏览器连接起来，他们为用户选择最匹配最合适的<strong>codec</strong>。</p>
</li>
<li><p>传输层</p>
<p>管理包的顺序。处理丢包。连接用户。</p>
</li>
<li><p>节点管理</p>
<p>管理，打开，阻止连接。</p>
</li>
</ul>
<h2 id="浏览器兼容"><a href="#浏览器兼容" class="headerlink" title="浏览器兼容"></a>浏览器兼容</h2><p>在这里检测</p>
<p><a href="https://caniuse.com/#feat=rtcpeerconnection" target="_blank" rel="noopener">https://caniuse.com/#feat=rtcpeerconnection</a></p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>实时交易</li>
<li>实时广告</li>
<li>下班后交流</li>
<li>HR管理</li>
<li>社交网络</li>
<li>数据服务</li>
<li>在线医疗</li>
<li>金融服务</li>
<li>监视</li>
<li>多人游戏</li>
<li>在线广播</li>
<li>在线教育</li>
</ul>
<h1 id="结构体系"><a href="#结构体系" class="headerlink" title="结构体系"></a>结构体系</h1><p><img src="https://www.tutorialspoint.com/webrtc/images/architecture.jpg" alt=""></p>
<p>三个不同层：</p>
<ul>
<li>web开发者API</li>
<li>浏览器厂家API</li>
<li>浏览器厂家可以hook的可覆盖的API</li>
</ul>
<h2 id="WebRTC-API"><a href="#WebRTC-API" class="headerlink" title="WebRTC API"></a>WebRTC API</h2><p>包括一些主要的js对象</p>
<ul>
<li><p>RTCPeerConnection</p>
<p>建立连接用的</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> conn = <span class="keyword">new</span> RTCPeerConnection(conf); </span><br><span class="line">conn.onaddstream = <span class="function"><span class="keyword">function</span>(<span class="params">stream</span>) </span>&#123; </span><br><span class="line">   <span class="comment">// use stream here </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>MediaStream</p>
<p>音视频处理</p>
<p>例子：</p>
<p>创建一个HTML网页：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span> = <span class="string">"utf-8"</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">	 </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>再加一个<code>client.js</code>文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//checks if the browser supports WebRTC </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasUserMedia</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia </span><br><span class="line">      || navigator.mozGetUserMedia || navigator.msGetUserMedia; </span><br><span class="line">   <span class="keyword">return</span> !!navigator.getUserMedia; </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (hasUserMedia()) &#123; </span><br><span class="line">   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia</span><br><span class="line">      || navigator.mozGetUserMedia || navigator.msGetUserMedia;</span><br><span class="line">		</span><br><span class="line">   <span class="comment">//get both video and audio streams from user's camera </span></span><br><span class="line">   navigator.getUserMedia(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">stream</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">var</span> video = <span class="built_in">document</span>.querySelector(<span class="string">'video'</span>); </span><br><span class="line">		</span><br><span class="line">      <span class="comment">//insert stream into the video tag </span></span><br><span class="line">      video.src = <span class="built_in">window</span>.URL.createObjectURL(stream); </span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;&#125;); </span><br><span class="line">	</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   alert(<span class="string">"Error. WebRTC is not supported!"</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后打开那个HTML网页就能看到你自己啦~</p>
</li>
<li><p>RTCDataChannel</p>
<p>通过RTCPeerConnection对象来创建频道</p>
<p>例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> peerConn = <span class="keyword">new</span> RTCPeerConnection(); </span><br><span class="line"></span><br><span class="line"><span class="comment">//establishing peer connection </span></span><br><span class="line"><span class="comment">//... </span></span><br><span class="line"><span class="comment">//end of establishing peer connection </span></span><br><span class="line"><span class="keyword">var</span> dataChannel = peerConnection.createDataChannel(<span class="string">"myChannel"</span>, dataChannelOptions); </span><br><span class="line"></span><br><span class="line"><span class="comment">// here we can start sending direct messages to another peer</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>  这里作者用的就是 HTML+JS+Node.js</p>
<p>安装好后。在终端输入 <code>node</code>测试nodejs工作了。</p>
<p>然后用Node.js的WebSockets库来搭建信令服务器。</p>
<p><code>npm install ws</code>安装WebSocket</p>
<p>为了测试信令服务器，<code>npm install -g wscat</code>安装wscat.</p>
<table>
<thead>
<tr>
<th>S.No</th>
<th>Protocols &amp; Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_protocols.htm" target="_blank" rel="noopener">WebRTC Protocols</a>WebRTC applications use UDP (User Datagram Protocol) as the transport protocol. Most web applications today are built with the using of the TCP (Transmission Control Protocol)</td>
</tr>
<tr>
<td>2</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_session_description_protocol.htm" target="_blank" rel="noopener">Session Description Protocol</a>The SDP is an important part of the WebRTC. It is a protocol that is intended to describe media communication sessions.</td>
</tr>
<tr>
<td>3</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_finding_route.htm" target="_blank" rel="noopener">Finding a Route</a>In order to connect to another user, you should find a clear path around your own network and the other user’s network. But there are chances that the network you are using has several levels of access control to avoid security issues.</td>
</tr>
<tr>
<td>4</td>
<td><a href="https://www.tutorialspoint.com/webrtc/webrtc_sctp.htm" target="_blank" rel="noopener">Stream Control Transmission Protocol</a>With the peer connection, we have the ability to send quickly video and audio data. The SCTP protocol is used today to send blob data on top of our currently setup peer connection when using the RTCDataChannel object.</td>
</tr>
</tbody>
</table>
<h1 id="MediaStream-APIs"><a href="#MediaStream-APIs" class="headerlink" title="MediaStream APIs"></a>MediaStream APIs</h1><p>这个API用于轻松从本地的摄像头麦克风获取流媒体。<code>getUserMedia()</code>方法是最常用的。</p>
<p>关键点：</p>
<ul>
<li>一个流对象（音频/视频）呈现一个实时媒体</li>
<li>在抓取这些媒体流之前，会询问用户的授权</li>
<li>输入设备的选择是可用API规定的。</li>
</ul>
<p>每个MediaSteam对象包含多个MediaSteamTrack对象。他们展示不同输入设备输入进来的音频、视频。</p>
<p>每个MediaSteamTrack对象可能包含多个频道（左/右声道）。</p>
<hr>
<p>输出MediaSteam对象有两种方法，1，输出到一个video或audio元素中。2，发送输出给RTCpeerConnection对象，它可以再发送给更远的peer。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>又举了一遍上面举过的html+client.js的例子。</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><strong>MediaStream.active(read only)</strong> 如果激活了返回true</li>
<li><strong>MediaSteam.ended(read only,deprecated)</strong> 如果流没有到达，返回<u>false</u>；如果事件对象已经被解除（说明流已经被读完），返回<u>true</u></li>
<li><strong>MediaSteam.id(read only)</strong>对象的唯一id</li>
<li><strong>MediaSteam.label(read only, deprecated)</strong>  根据用户代理分配的唯一标识<br>你可以在浏览器中console查看这些特性</li>
</ul>
<p><img src="../../../../../../../var/folders/r1/fl4npcxs78q5kh714tg987wm0000gn/T/abnerworks.Typora/image-20180829102518714.png" alt="image-20180829102518714"></p>
<h3 id="事件句柄"><a href="#事件句柄" class="headerlink" title="事件句柄"></a>事件句柄</h3><ul>
<li><strong>MediaStream.onactive</strong> −  一个MediaStream 对象变成激活的<em>active</em> 事件的句柄 </li>
<li><strong>MediaStream.onaddtrack</strong> − 添加了新的<em> </em>MediaStreamTrack* 对象后的句柄</li>
<li><strong>MediaStream.onended (deprecated)</strong> − 结束并解除的句柄</li>
<li><strong>MediaStream.oninactive</strong> − 一个 <em>MediaStream</em>对象变成激活状态后的 <em>inactive</em> 时间句柄</li>
<li><strong>MediaStream.onremovetrack</strong> −  一个 <em>MediaStreamTrack</em> 对象被激活后的 <em>removetrack</em>事件句柄</li>
</ul>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ul>
<li><strong>MediaStream.addTrack()</strong> − 添加 <em>MediaStreamTrack</em> 对象到MediaStream. 如果这个Track已经添加则什么都不做。</li>
<li><strong>MediaStream.clone()</strong> − 返回一个有新ID的MediaStream对象。</li>
<li><strong>MediaStream.getAudioTracks()</strong> − 从<em>MediaStream</em> 对象中返回一个list音频 <em>MediaStreamTrack</em> 对象 </li>
<li><strong>MediaStream.getVideoTracks()</strong> − 类比上一个</li>
<li><strong>MediaStream.getTrackById()</strong> − 返回trackID。 如果argument为空返回null。如果多个tracks ID相同返回第一个。</li>
<li><strong>MediaStream.getTracks()</strong> − 返回一个 <em>MediaStream</em>对象的所有 <em>MediaStreamTrack</em>对象</li>
<li><strong>MediaStream.removeTrack()</strong> − 从MediaSteam中移除 <em>MediaStreamTrack</em>对象。如果这个track已经被移除则什么也不做</li>
</ul>
<p>例子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span> = <span class="string">"en"</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span> = <span class="string">"utf-8"</span> /&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">autoplay</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetAudioTracks"</span>&gt;</span>getAudioTracks()</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetTrackById"</span>&gt;</span>getTrackById()</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetTracks"</span>&gt;</span>getTracks()<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnGetVideoTracks"</span>&gt;</span>getVideoTracks()</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnRemoveAudioTrack"</span>&gt;</span>removeTrack() - audio</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btnRemoveVideoTrack"</span>&gt;</span>removeTrack() - video</span><br><span class="line">         <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stream;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasUserMedia</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">   <span class="comment">//check if the browser supports the WebRTC </span></span><br><span class="line">   <span class="keyword">return</span> !!(navigator.getUserMedia || navigator.webkitGetUserMedia || </span><br><span class="line">      navigator.mozGetUserMedia); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (hasUserMedia()) &#123;</span><br><span class="line">   navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia</span><br><span class="line">      || navigator.mozGetUserMedia; </span><br><span class="line">		</span><br><span class="line">   <span class="comment">//enabling video and audio channels </span></span><br><span class="line">   navigator.getUserMedia(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">s</span>) </span>&#123; </span><br><span class="line">      stream = s; </span><br><span class="line">      <span class="keyword">var</span> video = <span class="built_in">document</span>.querySelector(<span class="string">'video'</span>); </span><br><span class="line">		</span><br><span class="line">      <span class="comment">//inserting our stream to the video tag     </span></span><br><span class="line">      video.src = <span class="built_in">window</span>.URL.createObjectURL(stream); </span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;&#125;); </span><br><span class="line">	</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">   alert(<span class="string">"WebRTC is not supported"</span>); </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">btnGetAudioTracks.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getAudioTracks"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getAudioTracks()); </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">btnGetTrackById.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getTrackById"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getTrackById(stream.getAudioTracks()[<span class="number">0</span>].id)); </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">btnGetTracks.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getTracks()"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getTracks()); </span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">btnGetVideoTracks.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"getVideoTracks()"</span>); </span><br><span class="line">   <span class="built_in">console</span>.log(stream.getVideoTracks()); </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">btnRemoveAudioTrack.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"removeAudioTrack()"</span>); </span><br><span class="line">   stream.removeTrack(stream.getAudioTracks()[<span class="number">0</span>]); </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line">btnRemoveVideoTrack.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"removeVideoTrack()"</span>); </span><br><span class="line">   stream.removeTrack(stream.getVideoTracks()[<span class="number">0</span>]); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="RTCDataChannel-APIs"><a href="#RTCDataChannel-APIs" class="headerlink" title="RTCDataChannel APIs"></a>RTCDataChannel APIs</h1><p>WebRTC不仅擅长发送音频和视频，还可能是各种数据。这就是RTCDataChannel对象的功能。</p>
<h2 id="RTCDataChannel-API"><a href="#RTCDataChannel-API" class="headerlink" title="RTCDataChannel API"></a>RTCDataChannel API</h2><h3 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h3><ul>
<li><p><strong>RTCDataChannel.label (read only)</strong> − 返回一个数据频道名的字符串</p>
</li>
<li><p><strong>RTCDataChannel.ordered (read only)</strong> − 如果消息投递顺序有保障返回true。没保证返回false。</p>
</li>
<li><p><strong>RTCDataChannel.protocol (read only)</strong> −返回这个频道使用的子协议名的字符串。</p>
</li>
<li><p><strong>RTCDataChannel.id (read only)</strong> − 返回RTCDataChannel对象创建时的唯一id</p>
</li>
<li><p><strong>RTCDataChannel.readyState (read only)</strong> − 返回 RTCDataChannelState enum描述连接状态。</p>
<p>可能的值：</p>
<ul>
<li><strong>connecting</strong> − Indicates that the connection is not yet active. This is the initial state.</li>
<li><strong>open</strong> − Indicates that the connection is running.</li>
<li><strong>closing</strong> − Indicates that the connection is in the process of shutting down. The cached messages are in the process of being sent or received, but no newly created task is accepting.</li>
<li><strong>closed</strong> − Indicates that the connection could not be established or has been shut down.</li>
</ul>
</li>
<li><p><strong>RTCDataChannel.bufferedAmount (read only)</strong> − Returns the amount of bytes that have been queued for sending. This is the amount of data that has not been sent yet via RTCDataChannel.send().</p>
</li>
<li><p><strong>RTCDataChannel.bufferedAmountLowThreshold</strong> − Returns the number of bytes at which the RTCDataChannel.bufferedAmount is taken up as low. When the RTCDataChannel.bufferedAmount decreases below this threshold, the bufferedamountlow event is fired.</p>
</li>
<li><p><strong>RTCDataChannel.binaryType</strong> − Returns the type of the binary data transmitted by the connection. Can be “blob” or “arraybuffer”.</p>
</li>
<li><p><strong>RTCDataChannel.maxPacketLifeType (read only)</strong> − Returns an unsigned short that indicates the length in milliseconds of the window in when messaging is going in unreliable mode.</p>
</li>
<li><p><strong>RTCDataChannel.maxRetransmits (read only)</strong> − Returns an unsigned short that indicates the maximum number of times a channel will retransmit data if it is not delivered.</p>
</li>
<li><p><strong>RTCDataChannel.negotiated (read only)</strong> − Returns a boolean that indicates if the channel has been negotiated by the user-agent, or by the application.</p>
</li>
<li><p><strong>RTCDataChannel.reliable (read only)</strong> − Returns a boolean that indicates of the connection can send messages in unreliable mode.</p>
</li>
<li><p><strong>RTCDataChannel.stream (read only)</strong> − Synonym for RTCDataChannel.id</p>
</li>
</ul>
<h3 id="Event-Handlers"><a href="#Event-Handlers" class="headerlink" title="Event Handlers"></a>Event Handlers</h3><ul>
<li><strong>RTCDataChannel.onopen</strong> − This event handler is called when the open event is fired. This event is sent when the data connection has been established.</li>
<li><strong>RTCDataChannel.onmessage</strong> − This event handler is called when the message event is fired. The event is sent when a message is available on the data channel.</li>
<li><strong>RTCDataChannel.onbufferedamountlow</strong> − This event handler is called when the bufferedamoutlow event is fired. This event is sent when RTCDataChannel.bufferedAmount decreases below the RTCDataChannel.bufferedAmountLowThreshold property.</li>
<li><strong>RTCDataChannel.onclose</strong> − This event handler is called when the close event is fired. This event is sent when the data connection has been closed.</li>
<li><strong>RTCDataChannel.onerror</strong> − This event handler is called when the error event is fired. This event is sent when an error has been encountered.</li>
</ul>
<h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><ul>
<li><strong>RTCDataChannel.close()</strong> − Closes the data channel.</li>
<li><strong>RTCDataChannel.send()</strong> − Sends the data in the parameter over the channel. The data can be a blob, a string, an ArrayBuffer or an ArrayBufferView.</li>
</ul>
<p>未完。</p>
<center>翻译自<a href="https://www.tutorialspoint.com/webrtc/index.htm没有全文翻译。侵权删。" target="_blank" rel="noopener">https://www.tutorialspoint.com/webrtc/index.htm没有全文翻译。侵权删。</a></center>
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/tutorial/" rel="tag"># tutorial</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/WebRTC/WebRTC02查资料/" rel="next" title="WebRTC02查基础资料">
                <i class="fa fa-chevron-left"></i> WebRTC02查基础资料
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/WebRTC04Kurento流程分析/" rel="prev" title="WebRTC04KurentoDemo流程分析">
                WebRTC04KurentoDemo流程分析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTg2My82NDI5"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ixsim</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="mailto:xuanshanli@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/lixsh" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://oo1.win/" title="炫猿" target="_blank">炫猿</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.aimoon.site" title="我大哥" target="_blank">我大哥</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://onebigcabbage.github.io" title="小菜哥" target="_blank">小菜哥</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Home"><span class="nav-number">1.</span> <span class="nav-text">Home</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#概览"><span class="nav-number">2.</span> <span class="nav-text">概览</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本格局"><span class="nav-number">2.1.</span> <span class="nav-text">基本格局</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器兼容"><span class="nav-number">2.2.</span> <span class="nav-text">浏览器兼容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用场景"><span class="nav-number">2.3.</span> <span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#结构体系"><span class="nav-number">3.</span> <span class="nav-text">结构体系</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WebRTC-API"><span class="nav-number">3.1.</span> <span class="nav-text">WebRTC API</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#环境"><span class="nav-number">4.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MediaStream-APIs"><span class="nav-number">5.</span> <span class="nav-text">MediaStream APIs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用"><span class="nav-number">5.1.</span> <span class="nav-text">使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">5.2.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特性"><span class="nav-number">5.2.1.</span> <span class="nav-text">特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件句柄"><span class="nav-number">5.2.2.</span> <span class="nav-text">事件句柄</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法"><span class="nav-number">5.2.3.</span> <span class="nav-text">方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RTCDataChannel-APIs"><span class="nav-number">6.</span> <span class="nav-text">RTCDataChannel APIs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RTCDataChannel-API"><span class="nav-number">6.1.</span> <span class="nav-text">RTCDataChannel API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#特性-1"><span class="nav-number">6.1.1.</span> <span class="nav-text">特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Event-Handlers"><span class="nav-number">6.1.2.</span> <span class="nav-text">Event Handlers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Methods"><span class="nav-number">6.1.3.</span> <span class="nav-text">Methods</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">炫杉 ❤ 紫玉</span>

  

  
</div>








        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.4.0"></script>



  

  
  <script>
    
    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function ({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', `/classes/Counter/${counter.objectId}`, JSON.stringify({ time: { "__op":"Increment", "amount":1 } }))
            
            .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.time + 1);
            })
            
            .fail(function ({ responseJSON }) {
                console.log('Failed to save Visitor num, with error message: ' + responseJSON.error);
            })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1}))
                .done(function () {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function () {
                  console.log('Failed to create');
                });
            
          }
        })
      .fail(function ({ responseJSON }) {
        console.log('LeanCloud Counter Error:' + responseJSON.code + " " + responseJSON.error);
      });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "2ajpEY5ADgyM7Usf91Y3w9FC-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "2ajpEY5ADgyM7Usf91Y3w9FC-gzGzoHsz",
                'X-LC-Key': "OOKhkox53eeWftN6OLR9jeYg",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          addCount(Counter);
          
        })
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  
  
  
    
  
  <script src="https://cdn.jsdelivr.net/gh/theme-next/theme-next-bookmark@latest/bookmark.min.js"></script>
  <script type="text/javascript">
  
    bookmark.scrollToMark('auto', "#更多");
  
  </script>


  

  
</body>
</html>
