
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>WebRTC05入门教程02 | 炫杉</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ixsim">
    

    
    <meta name="description" content="p2p的核心RTCPeerConnection APIs的介绍">
<meta name="keywords" content="Demo,tutorial">
<meta property="og:type" content="article">
<meta property="og:title" content="WebRTC05入门教程02">
<meta property="og:url" content="https://ixsim.github.io/WebRTC/WebRTC05入门教程02/index.html">
<meta property="og:site_name" content="炫杉">
<meta property="og:description" content="p2p的核心RTCPeerConnection APIs的介绍">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-09-03T06:30:47.040Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebRTC05入门教程02">
<meta name="twitter:description" content="p2p的核心RTCPeerConnection APIs的介绍">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="炫杉" title="炫杉"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="炫杉">炫杉</a></h1>
				<h2 class="blog-motto">提着鸟笼的老头站在一旁拍我肩膀 我猜他想的应该和我一样</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:ixsim.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/WebRTC/WebRTC05入门教程02/" title="WebRTC05入门教程02" itemprop="url">WebRTC05入门教程02</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ixsim" target="_blank" itemprop="author">ixsim</a>
		
  <p class="article-time">
    <time datetime="2018-08-30T06:29:44.000Z" itemprop="datePublished"> 发表于 2018-08-30</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RTCPeerConnection-APIs"><span class="toc-number">1.</span> <span class="toc-text">RTCPeerConnection APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RTCPeerConnection-API"><span class="toc-number">1.1.</span> <span class="toc-text">RTCPeerConnection API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性"><span class="toc-number">1.1.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件句柄"><span class="toc-number">1.1.2.</span> <span class="toc-text">事件句柄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Methods"><span class="toc-number">1.1.3.</span> <span class="toc-text">Methods</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#建立一个连接"><span class="toc-number">1.1.4.</span> <span class="toc-text">建立一个连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小知识点"><span class="toc-number">1.2.</span> <span class="toc-text">小知识点</span></a></li></ol></li></ol>
		
		</div>
		
		<p>p2p的核心<strong>RTCPeerConnection APIs</strong>的介绍</p>
<a id="more"></a>
<h1 id="RTCPeerConnection-APIs"><a href="#RTCPeerConnection-APIs" class="headerlink" title="RTCPeerConnection APIs"></a>RTCPeerConnection APIs</h1><p>简单样例：<code>var pc = RTCPeerConnection(config);</code></p>
<p>config包含 key, iceServers。这是一个有着STUN和TURN服务器信息的URL对象数组，用于查找ICE候选。你可以在<a href="https://code.google.com找到一些可用的公共STUN服务器" target="_blank" rel="noopener">https://code.google.com找到一些可用的公共STUN服务器</a>.</p>
<p>这是user’s flow用户流的一个例子：</p>
<ul>
<li>注册<em>onincecandidate</em>句柄。收到时发送ICE candidates给其他peer。</li>
<li>注册<em>onaddstream</em>句柄。一旦收到远端peer接收，则控制视频流的展示</li>
<li>注册<em>message</em>句柄。你的信令服务器应该也有一个句柄用于收消息。如果message包含<em>RTCSeesionDescription</em>对象，则使用<em>setRemoteDescription()</em>方法将其加入到<u><em>RTCPeerConnection</em></u><u>对象</u>。如果message包含<em>RTCIceCandidate</em>对象，使用<em>addIceCandidate()</em>方法将其加入到<u><em>RTCPeerConnection</em></u><u>对象</u>。</li>
<li>用<em>getUserMedia()</em>设置本地媒体流，用 <em>addStream()</em> 方法将其加入到<u><em>RTCPeerConnection</em></u><u>对象</u>。</li>
<li>开始 <strong>offer/answer</strong> 协商。这是唯一一个[主叫流caller flow]和[被叫callee]有所不同的一步。caller用<strong><u><em>createOffer()</em></u></strong>方法开始协商，注册一个接收 <em><u>RTCSessionDescription</u></em>对象的callback。这个callback应使用<em>setLocalDescriptionI()</em>方法添加这个<em><u>RTCSessionDescription</u></em>到你的<em>RTCPeerConnection</em>。  最后，caller应该用信令服务器发送这个<em><u>RTCPeerConnection</u></em>到远端peer。 callee注册相同的callback，但是用的是<strong><u><em>createAnswer()</em></u></strong>方法。仅在收到caller的<strong>offer</strong>后callee flow初始化完成。</li>
</ul>
<h2 id="RTCPeerConnection-API"><a href="#RTCPeerConnection-API" class="headerlink" title="RTCPeerConnection API"></a>RTCPeerConnection API</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li><p><strong>RTCPeerConnection.iceConnectionState (read only)</strong> − 返回一个RTCIceConnectionState</p>
<p>enum描述连接状态.  值改变时触发一个iceconnectionstatechange 事件。</p>
<p>可能的值：</p>
<ul>
<li><strong>new</strong> − ICE代理在等待远程候选或收集地址。</li>
<li><strong>checking</strong> − ICE 代理 有远程候选但还没有发现连接。</li>
<li><strong>connected</strong> − ICE 代理已经发现了可用连接，但仍然在checking更远的候选以便更好地连接。</li>
<li><strong>completed</strong> − ICE 代理已经发现了可用连接并停止检测远程候选。</li>
<li><strong>failed</strong> − ICE 代理已经检查完所有的远程候选们但找不到一个可匹配的。</li>
<li><strong>disconnected</strong> − 至少有一个部分不再工作。</li>
<li><strong>closed</strong> − ICE 代理关闭。</li>
</ul>
</li>
<li><p><strong>RTCPeerConnection.iceGatheringState (read only)</strong> − 返回一个 RTCIceGatheringState enum描述连接的ICE收集状态−</p>
<ul>
<li><strong>new</strong> − 对象刚被创建</li>
<li><strong>gathering</strong> − ICE 代理在收集候选过程中</li>
<li><strong>complete</strong> ICE 代理 已经完成收集</li>
</ul>
</li>
<li><p><strong>RTCPeerConnection.localDescription (read only)</strong> − 返回一个RTCSessionDescription 描述本地节点。如果还没有被设置则为null</p>
</li>
<li><p><strong>RTCPeerConnection.peerIdentity (read only)</strong> − 返回一个 RTCIdentityAssertion. 包含一个idp(domain name) 和一个描述远程peer的name</p>
</li>
<li><p><strong>RTCPeerConnection.remoteDescription (read only)</strong> − 返回一个 RTCSessionDescription 描述远程节点. 没设置为null</p>
</li>
<li><p><strong>RTCPeerConnection.signalingState (read only)</strong> − 返回一个 RTCSignalingState enum描述本地连接的信令状态。这个状态描述SDP offer。值改变时触发一个signalingstatechange 事件。可能的值： </p>
<ul>
<li><strong>stable</strong> − 初始状态。不存在 SDP offer/answer 交换。</li>
<li><strong>have-local-offer</strong> − 连接的本地端已经在当地申请了一个SDP offer.</li>
<li><strong>have-remote-offer</strong> − 连接的远程端已经在当地申请了一个SDP offer.</li>
<li><strong>have-local-pranswer</strong> − 一个远程SDP offer已申请，本地已申请一个SDP pranswer.</li>
<li><strong>have-remote-pranswer</strong> − 一个本地SDP已申请，远程已申请一个SDP pranswer.</li>
<li><strong>closed</strong> − 连接关闭。</li>
</ul>
</li>
</ul>
<h3 id="事件句柄"><a href="#事件句柄" class="headerlink" title="事件句柄"></a>事件句柄</h3><p>下面是常用的几个</p>
<table>
<thead>
<tr>
<th style="text-align:right">Event Handlers</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onaddstream</strong></td>
<td style="text-align:left">addstream 事件触发. 当MediaSteam被远程peer添加到连接中时发送这个事件。</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.ondatachannel</strong></td>
<td style="text-align:left">datachannel 事件触发. 当RTCDataChannel添加到连接中时发送这个事件。</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onicecandidate</strong></td>
<td style="text-align:left">Icecandidate 事件触发. 当RTCIceCandidate对象添加到script中时发送这个事件。</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.oniceconnectionstatechange</strong></td>
<td style="text-align:left">This handler is called when Iceconnectionstatechange 事件触发时. This event is sent 当value of iceConnectionState changes.</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onidentityresult</strong></td>
<td style="text-align:left">This handler is called when Identityresult 事件触发时. This event is sent when an identity assertion is generated during the creating of an offer or an answer of via getIdentityAssertion().</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onidpassertionerror</strong></td>
<td style="text-align:left">This handler is called when Idpassertionerror 事件触发时. This event is sent when IdP (Identitry Provider) finds an error while generating an identity assertion.</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onidpvalidation</strong></td>
<td style="text-align:left">This handler is called when Idpvalidationerror 事件触发时. This event is sent when IdP (Identitry Provider) finds an error while validating an identity assertion.</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onnegotiationneeded</strong></td>
<td style="text-align:left">This handler is called 当negotiationneeded 事件触发时. This event is sent by the browser to inform the negotiation will be required at some point in the future.</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onpeeridentity</strong></td>
<td style="text-align:left">This handler is called 当peeridentity 事件触发时. This event is sent when a peer identity has been set and verified on this connection.</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onremovestream</strong></td>
<td style="text-align:left">This handler is called 当signalingstatechange 事件触发时. This event is sent 当value of signalingState changes.</td>
</tr>
<tr>
<td style="text-align:right"><strong>RTCPeerConnection.onsignalingstatechange</strong></td>
<td style="text-align:left">This handler is called 当removestream 事件触发时. This event is sent when a MediaStream is removed from this connection.</td>
</tr>
</tbody>
</table>
<h3 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h3><p>下面是常用的几个</p>
<table>
<thead>
<tr>
<th>S.No.</th>
<th>Methods &amp; Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><strong>RTCPeerConnection()</strong>返回一个 new RTCPeerConnection object.</td>
</tr>
<tr>
<td>2</td>
<td><strong>RTCPeerConnection.createOffer()</strong>Creates an offer(request) to find a remote peer. The two first parameters of this method are success and error callbacks. The optional third parameter are options, like enabling audio or video streams.</td>
</tr>
<tr>
<td>3</td>
<td><strong>RTCPeerConnection.createAnswer()</strong>Creates an answer to the offer received by the remote peer during the offer/answer negotiation process. The two first parameters of this method are success and error callbacks. The optional third parameter are options for the answer to be created.</td>
</tr>
<tr>
<td>4</td>
<td><strong>RTCPeerConnection.setLocalDescription()</strong>Changes the local connection description. The description defines the properties of the connection. The connection must be able to support both old and new descriptions. The method takes three parameters, RTCSessionDescription object, callback if the change of description succeeds, callback if the change of description fails.</td>
</tr>
<tr>
<td>5</td>
<td><strong>RTCPeerConnection.setRemoteDescription()</strong>Changes the remote connection description. The description defines the properties of the connection. The connection must be able to support both old and new descriptions. The method takes three parameters, RTCSessionDescription object, callback if the change of description succeeds, callback if the change of description fails.</td>
</tr>
<tr>
<td>6</td>
<td><strong>RTCPeerConnection.updateIce()</strong>Updates ICE 代理 process of pinging remote candidates and gathering local candidates.</td>
</tr>
<tr>
<td>7</td>
<td><strong>RTCPeerConnection.addIceCandidate()</strong>Provides a remote candidate to ICE 代理.</td>
</tr>
<tr>
<td>8</td>
<td><strong>RTCPeerConnection.getConfiguration()</strong>返回一个 RTCConfiguration object. It represents the configuration of the RTCPeerConnection object.</td>
</tr>
<tr>
<td>9</td>
<td><strong>RTCPeerConnection.getLocalStreams()</strong>返回一个n array of local MediaStream connection.</td>
</tr>
<tr>
<td>10</td>
<td><strong>RTCPeerConnection.getRemoteStreams()</strong>返回一个n array of remote MediaStream connection.</td>
</tr>
<tr>
<td>11</td>
<td><strong>RTCPeerConnection.getStreamById()</strong>Returns local or remote MediaStream by the given ID.</td>
</tr>
<tr>
<td>12</td>
<td><strong>RTCPeerConnection.addStream()</strong>Adds a MediaStream as a local source of video or audio.</td>
</tr>
<tr>
<td>13</td>
<td><strong>RTCPeerConnection.removeStream()</strong>Removes a MediaStream as a local source of video or audio.</td>
</tr>
<tr>
<td>14</td>
<td><strong>RTCPeerConnection.close()</strong>Closes a connection.</td>
</tr>
<tr>
<td>15</td>
<td><strong>RTCPeerConnection.createDataChannel()</strong>Creates a new RTCDataChannel.</td>
</tr>
<tr>
<td>16</td>
<td><strong>RTCPeerConnection.createDTMFSender()</strong>Creates a new RTCDTMFSender, associated to a specific MediaStreamTrack. Allows to send DTMF (Dual-tone multifrequency) phone signaling over the connection.</td>
</tr>
<tr>
<td>17</td>
<td><strong>RTCPeerConnection.getStats()</strong>Creates a new RTCStatsReport that contains statistics concerning the connection.</td>
</tr>
<tr>
<td>18</td>
<td><strong>RTCPeerConnection.setIdentityProvider()</strong>Sets IdP. Takes three parameters − the name, the protocol used to communicate and an optional username.</td>
</tr>
<tr>
<td>19</td>
<td><strong>RTCPeerConnection.getIdentityAssertion()</strong>Gathers an identity assertion. It is not expected to deal with this method in the application. So you may call it explicitly only to anticipate the need.</td>
</tr>
</tbody>
</table>
<h3 id="建立一个连接"><a href="#建立一个连接" class="headerlink" title="建立一个连接"></a>建立一个连接</h3><p>先把信令服务器跑起来。</p>
<p>代码：<code>server.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//信令服务器代码请转到入门教程03</span></span><br></pre></td></tr></table></figure>
<p>然后<code>node server</code> 把上面的信令服务器跑起来。</p>
<p>（教程01说过要安装好nodejs环境）</p>
<p>如果想测试是否跑起来了，可以用wscat命令：</p>
<p><code>wscat -c ws://localhost:9090</code> </p>
<p>然后是前端：<code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span> = <span class="string">"en"</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span> = <span class="string">"utf-8"</span> /&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">   <span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span> </span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">id</span> = <span class="string">"loginInput"</span> /&gt;</span> </span><br><span class="line">         <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"loginBtn"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span> </span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">"text"</span> <span class="attr">id</span> = <span class="string">"otherUsernameInput"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"connectToOtherUsernameBtn"</span>&gt;</span>Establish connection<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">		</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span> = <span class="string">"client.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">   <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个不用解释吧。就是两个输入框两个按钮。</p>
<p>最后是客户端js文件：<code>client.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> connection = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:9090'</span>); </span><br><span class="line"><span class="keyword">var</span> name = <span class="string">""</span>; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> loginInput = <span class="built_in">document</span>.querySelector(<span class="string">'#loginInput'</span>); </span><br><span class="line"><span class="keyword">var</span> loginBtn = <span class="built_in">document</span>.querySelector(<span class="string">'#loginBtn'</span>); </span><br><span class="line"><span class="keyword">var</span> otherUsernameInput = <span class="built_in">document</span>.querySelector(<span class="string">'#otherUsernameInput'</span>); </span><br><span class="line"><span class="keyword">var</span> connectToOtherUsernameBtn = <span class="built_in">document</span>.querySelector(<span class="string">'#connectToOtherUsernameBtn'</span>); </span><br><span class="line"><span class="keyword">var</span> connectedUser, myConnection;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//当一个用户点击登录 </span></span><br><span class="line">loginBtn.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123; </span><br><span class="line">   name = loginInput.value; </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(name.length &gt; <span class="number">0</span>)&#123; <span class="comment">//发送一个message&#123; </span></span><br><span class="line">         type: <span class="string">"login"</span>, </span><br><span class="line">         name: name </span><br><span class="line">      &#125;</span><br><span class="line">      send(&#123; </span><br><span class="line">         type: <span class="string">"login"</span>, </span><br><span class="line">         name: name </span><br><span class="line">      &#125;); </span><br><span class="line">   &#125; </span><br><span class="line">   </span><br><span class="line">&#125;);</span><br><span class="line">  </span><br><span class="line"><span class="comment">//handle messages from the server </span></span><br><span class="line">connection.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">message</span>) </span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Got message"</span>, message.data);</span><br><span class="line">   <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(message.data); </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">switch</span>(data.type) &#123; </span><br><span class="line">      <span class="keyword">case</span> <span class="string">"login"</span>: </span><br><span class="line">         onLogin(data.success); </span><br><span class="line">         <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="string">"offer"</span>: </span><br><span class="line">         onOffer(data.offer, data.name); </span><br><span class="line">         <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="string">"answer"</span>: </span><br><span class="line">         onAnswer(data.answer); </span><br><span class="line">         <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">case</span> <span class="string">"candidate"</span>: </span><br><span class="line">         onCandidate(data.candidate); </span><br><span class="line">         <span class="keyword">break</span>; </span><br><span class="line">      <span class="keyword">default</span>: </span><br><span class="line">         <span class="keyword">break</span>; </span><br><span class="line">   &#125; </span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//当用户登录</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onLogin</span>(<span class="params">success</span>) </span>&#123; </span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (success === <span class="literal">false</span>) &#123; <span class="comment">//重名了</span></span><br><span class="line">      alert(<span class="string">"oops...try a different username"</span>); </span><br><span class="line">   &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">      <span class="comment">//创建RTCPeerConnection对象 </span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">var</span> configuration = &#123; </span><br><span class="line">         <span class="string">"iceServers"</span>: [&#123; <span class="string">"url"</span>: <span class="string">"stun:stun.1.google.com:19302"</span> &#125;] </span><br><span class="line">      &#125;; </span><br><span class="line">      </span><br><span class="line">      myConnection = <span class="keyword">new</span> webkitRTCPeerConnection(configuration); </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"RTCPeerConnection object was created"</span>); </span><br><span class="line">      <span class="built_in">console</span>.log(myConnection); </span><br><span class="line">  </span><br><span class="line">      <span class="comment">//setup ice handling</span></span><br><span class="line">      <span class="comment">//当浏览器发现一个ICE候选我们就发送给其他人。 </span></span><br><span class="line">      myConnection.onicecandidate = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123; </span><br><span class="line">      </span><br><span class="line">         <span class="keyword">if</span> (event.candidate) &#123; </span><br><span class="line">            send(&#123; </span><br><span class="line">               type: <span class="string">"candidate"</span>, </span><br><span class="line">               candidate: event.candidate </span><br><span class="line">            &#125;); </span><br><span class="line">         &#125; </span><br><span class="line">      &#125;; </span><br><span class="line">   &#125; </span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">connection.onopen = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Connected"</span>); </span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line">connection.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123; </span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Got error"</span>, err); </span><br><span class="line">&#125;;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 发送JSON格式message的Alias(别名) </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params">message</span>) </span>&#123; </span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (connectedUser) &#123; </span><br><span class="line">      message.name = connectedUser; </span><br><span class="line">   &#125; </span><br><span class="line">   </span><br><span class="line">   connection.send(<span class="built_in">JSON</span>.stringify(message)); </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//setup a peer connection with another user </span></span><br><span class="line">connectToOtherUsernameBtn.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line"> </span><br><span class="line">   <span class="keyword">var</span> otherUsername = otherUsernameInput.value; </span><br><span class="line">   connectedUser = otherUsername;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> (otherUsername.length &gt; <span class="number">0</span>) &#123; </span><br><span class="line">      <span class="comment">//make an offer </span></span><br><span class="line">      myConnection.createOffer(<span class="function"><span class="keyword">function</span> (<span class="params">offer</span>) </span>&#123; </span><br><span class="line">         <span class="built_in">console</span>.log(); </span><br><span class="line">         send(&#123; </span><br><span class="line">            type: <span class="string">"offer"</span>, </span><br><span class="line">            offer: offer </span><br><span class="line">         &#125;);</span><br><span class="line">         </span><br><span class="line">         myConnection.setLocalDescription(offer); </span><br><span class="line">      &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123; </span><br><span class="line">         alert(<span class="string">"An error has occurred."</span>); </span><br><span class="line">      &#125;); </span><br><span class="line">   &#125; </span><br><span class="line">&#125;); </span><br><span class="line"> </span><br><span class="line"><span class="comment">//当有人想打给我们 </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onOffer</span>(<span class="params">offer, name</span>) </span>&#123; </span><br><span class="line">   connectedUser = name; </span><br><span class="line">   myConnection.setRemoteDescription(<span class="keyword">new</span> RTCSessionDescription(offer)); </span><br><span class="line">   </span><br><span class="line">   myConnection.createAnswer(<span class="function"><span class="keyword">function</span> (<span class="params">answer</span>) </span>&#123; </span><br><span class="line">      myConnection.setLocalDescription(answer); </span><br><span class="line">      </span><br><span class="line">      send(&#123; </span><br><span class="line">         type: <span class="string">"answer"</span>, </span><br><span class="line">         answer: answer </span><br><span class="line">      &#125;); </span><br><span class="line">      </span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123; </span><br><span class="line">      alert(<span class="string">"oops...error"</span>); </span><br><span class="line">   &#125;); </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//另一个用户要answer我们的offer</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onAnswer</span>(<span class="params">answer</span>) </span>&#123; </span><br><span class="line">   myConnection.setRemoteDescription(<span class="keyword">new</span> RTCSessionDescription(answer)); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//当我们收到ICE候选</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onCandidate</span>(<span class="params">candidate</span>) </span>&#123; </span><br><span class="line">   myConnection.addIceCandidate(<span class="keyword">new</span> RTCIceCandidate(candidate)); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样 <strong>offer/answer</strong>的过程就模拟完了。可以通过输入输出在控制台看到相关信息.</p>
<h2 id="小知识点"><a href="#小知识点" class="headerlink" title="小知识点"></a>小知识点</h2><p><code>alisa</code>在 linux 中，alias 命令（注意全为小写）的功能是设置命令的别名，以简写命令，提高操作效率。根据参数的不同，该命令可查看已设定的别名，或为命令设置新的别名。对于用户自定义别名，仅当前登录期内有效；也可修改配置文件使其长期有效。</p>
<p>相关命令：<code>unalias</code></p>
<p>参考链接：<a href="https://baike.baidu.com/item/Alias/3105303#viewPageContent" target="_blank" rel="noopener">https://baike.baidu.com/item/Alias/3105303#viewPageContent</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/WebRTC/">WebRTC</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Demo/">Demo</a><a href="/tags/tutorial/">tutorial</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://ixsim.github.io/WebRTC/WebRTC05入门教程02/" data-title="WebRTC05入门教程02 | 炫杉" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/WebRTC/WebRTC06入门教程03/" title="WebRTC06入门教程03">
  <strong>上一篇：</strong><br/>
  <span>
  WebRTC06入门教程03</span>
</a>
</div>


<div class="next">
<a href="/WebRTC/WebRTC04Kurento流程分析/"  title="WebRTC04KurentoDemo流程分析">
 <strong>下一篇：</strong><br/> 
 <span>WebRTC04KurentoDemo流程分析
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RTCPeerConnection-APIs"><span class="toc-number">1.</span> <span class="toc-text">RTCPeerConnection APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RTCPeerConnection-API"><span class="toc-number">1.1.</span> <span class="toc-text">RTCPeerConnection API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#特性"><span class="toc-number">1.1.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#事件句柄"><span class="toc-number">1.1.2.</span> <span class="toc-text">事件句柄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Methods"><span class="toc-number">1.1.3.</span> <span class="toc-text">Methods</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#建立一个连接"><span class="toc-number">1.1.4.</span> <span class="toc-text">建立一个连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小知识点"><span class="toc-number">1.2.</span> <span class="toc-text">小知识点</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Algorithm/" title="Algorithm">Algorithm<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Blockchain/" title="Blockchain">Blockchain<sup>1</sup></a></li>
		  
		
		  
		
		  
		
		  
			<li><a href="/categories/Others/" title="Others">Others<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/WebRTC/" title="WebRTC">WebRTC<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/Website/" title="Website">Website<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>10</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Note/" title="Note">Note<sup>11</sup></a></li>
			
		
			
				<li><a href="/tags/Swift/" title="Swift">Swift<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>9</sup></a></li>
			
		
			
				<li><a href="/tags/Demo/" title="Demo">Demo<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/LeetCode/" title="LeetCode">LeetCode<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/tips/" title="tips">tips<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tutorial/" title="tutorial">tutorial<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/js/" title="js">js<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Spider/" title="Spider">Spider<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C++">C++<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Data-Analysis/" title="Data Analysis">Data Analysis<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Matlab/" title="Matlab">Matlab<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Swfit/" title="Swfit">Swfit<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/File-Process/" title="File Process">File Process<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/note/" title="note">note<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/IoT/" title="IoT">IoT<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/selenium/" title="selenium">selenium<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://oo1.win" target="_blank" title="炫猿">炫猿</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.aimoon.site/" target="_blank" title="我大哥">我大哥</a>
            
          </li>
        
          <li>
            
            	<a href="https://onebigcabbage.github.io/" target="_blank" title="小菜哥">小菜哥</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello, <br/>
			World!</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/lixsh" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
		<a href="mailto:xuanshanli@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="ixsim">ixsim</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
