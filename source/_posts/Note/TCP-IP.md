---
title: 《TCP/IP详解 卷1：协议》笔记
date: 2019-01-14 09:51:23
categories: Network
tags:
---

《TCP/IP详解 卷1：协议》读书笔记。图片来自本书在即时通许网的电子版：http://www.52im.net/topic-tcpipvol1.html

<!---more--->

# 第一章 概述

## 1.3 分层

![分层](http://docs.52im.net/extend/docs/book/tcpip/vol1/1/images2/52im_4.png)

## 1.7 分用

![分用](http://docs.52im.net/extend/docs/book/tcpip/vol1/1/images2/52im_8.png)

# 第二章 链路层

[图1.3](#1.3 分层)可看出，链路层三个目的：

1.为上层的IP模块发送和接收IP数据报

2、3. 为ARP和RARP发送请求和接收应答



## 2.6 PPP协议

这个东西还需要看看。



- 环回地址就是常用的那个localhost，

  当目的地址是环回地址时，可以省略部分传输层、**所有**网络层的逻辑操作。但是大多数产品还是照样完成所有过程，只不过IP数据报离开网络层又返回给自己。

# 第三章 IP

## 3.1 引言

- 不可靠 unreliable：不保证IP数据报成功到达目的地。

  发生错误，丢弃==》发送ICMP消息给信源

  任何要求的可靠性必须由上层提供

- 无连接 connectionless：IP并不维护任何关于后续数据报的状态信息；每个数据报的处理是相互独立的。

  这也说明，IP数据报可以不按发送顺序接收。如果一信源向相同的信宿发送两个连续的数据报，先A后B。A和B独立进行路由选择，可能选择不同的路线，因此B可能先于A到达。

## 3.2 IP首部

![](http://docs.52im.net/extend/docs/book/tcpip/vol1/3/images2/52im_1.png)

- 版本：4

- 首部长度：和下面的选项（如今没啥用）有关。普通IP数据报（没有任何选项）字段值是5（20个字节）

  占4bit： 最大1111是15(60个字节)

- TOS: 3bit的优先权字段（如今没用）

  4bit的子字段（只能有一个位置1）和1bit的未用位（必须置）：

  因此这5bit只有4种情况：10000、01000、00100、00010

  这是种就是tcpdump的命令输出：0x10\0x08\0x04\0x02这四个十六进制数

  ![图3-2 服务类型字段推荐值](http://docs.52im.net/extend/docs/book/tcpip/vol1/3/images2/52im_2.png)

- 总长 16bit IP数据报最长65535字节。但大多数链路层都会分片，**而且，**主机也要求不能接收超过576字节的数据报。

## 3.3 路由选择

所有的IP路由选择只为数据报传输提供下一站路由器的IP地址。它假定下一站路由器比发送数据报的主机更接近目的，而且下一站路由器与该主机是直接相连的。

# 第四章 ARP

地址解析协议

从逻辑Internet地址到对应的物理硬件地址需要进行翻译。这就是ARP的功能。ARP本来是用于广播网络的，有许多主机或路由器连在同一个网络上。

ARP发送一份称作ARP请求的以太网数据帧给以太网上的每个主机。这个过程称作广播，如图4-2中的虚线所示。ARP请求数据帧中包含目的主机的IP地址（主机名为bsdi），其意思是“如果你是这个IP地址的拥有者，请回答你的硬件地址。”

![图4-2 当用户输入命令"ftp主机名"时ARP的操作](http://docs.52im.net/extend/docs/book/tcpip/vol1/4/images2/52im_2.png)

ARP的功能是在32 bit的IP地址和采用不同网络技术的硬件地址之间提供动态映射。

## 4.3 ARP高速缓存

ARP高效运行的关键是由于每个主机上都有一个ARP高速缓存。这个高速缓存存放了最近Internet地址到硬件地址之间的映射记录。高速缓存中每一项的生存时间一般为20分钟，起始时间从被创建时开始算起。

我们可以用`arp`命令来检查ARP高速缓存。参数`-a`的意思是显示高速缓存中所有的内容。

## 4.6 ARP代理

如果ARP请求是从一个网络的主机发往另一个网络上的主机，那么连接这两个网络的路由器就可以回答该请求，这个过程称作委托ARP或ARP代理(Proxy ARP)。这样可以欺骗发起ARP请求的发送端，使它误以为路由器就是目的主机，而事实上目的主机是在路由器的“另一边”。路由器的功能相当于目的主机的代理，把分组从其他主机转发给它。

> 如果在主机gemini上执行arp命令，经过与主机sun通信以后，我们发现在同一个子网140.252.1上的netb和sun的IP地址映射的硬件地址是相同的。

ARP代理也称作混合ARP（promiscuousARP）或ARP出租(ARP hack)。这些名字来自于ARP代理的其他用途：通过两个物理网络之间的路由器可以互相隐藏物理网络。在这种情况下，两个物理网络可以使用相同的网络号，只要把中间的路由器设置成一个ARP代理，以响应一个网络到另一个网络主机的ARP请求。

## 4.9 小结

在大多数的TCP/IP实现中，ARP是一个基础协议，但是它的运行对于应用程序或系统管理员来说一般是透明的。ARP高速缓存在它的运行过程中非常关键，我们可以用arp命令对高速缓存进行检查和操作。高速缓存中的每一项内容都有一个定时器，根据它来删除不完整和完整的表项。arp命令可以显示和修改ARP高速缓存中的内容。

我们介绍了ARP的一般操作，同时也介绍了一些特殊的功能：委托ARP（当路由器对来自于另一个路由器接口的ARP请求进行应答时）和免费ARP（发送自己IP地址的ARP请求，一般发生在引导过程中）。

# 第五章 RARP

## 5.1 引言

具有本地磁盘的系统引导时，一般是从磁盘上的配置文件中读取IP地址。但是无盘机，如X终端或无盘工作站，则需要采用其他方法来获得IP地址。

网络上的每个系统都具有唯一的硬件地址，它是由网络接口生产厂家配置的。无盘系统的RARP实现过程是从接口卡上读取唯一的硬件地址，然后发送一份RARP请求（一帧在网络上广播的数据），请求某个主机响应该无盘系统的IP地址（在RARP应答中）。

在概念上这个过程是很简单的，但是实现起来常常比ARP要困难，其原因在本章后面介绍。RARP的正式规范是RFC 903[Finlayson et al.1984]。

# 第六章 ICMP

CMP经常被认为是IP层的一个组成部分。它传递差错报文以及其他需要注意的信息。ICMP报文通常被IP层或更高层协议（TCP或UDP）使用。一些ICMP报文把差错报文返回给用户进程。

ICMP报文是在IP数据报内部被传输的，如图6-1所示。

![第6章 ICMP:Internet控制报文协议_TCP/IP详解卷1 协议_即时通讯网(52im.net)](http://docs.52im.net/extend/docs/book/tcpip/vol1/6/images2/52im_net_1.png)

<center>图6-1 ICMP封装在IP数据报内部</center>

