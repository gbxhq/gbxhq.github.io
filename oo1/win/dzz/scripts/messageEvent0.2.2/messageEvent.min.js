/*!
 * messageEvent
 * Date: 2012-01-18 20:58
 * http://code.google.com/p/message-event/
 * (c) 2011 - 2012 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */var messageEvent={version:"0.2.2",postMessage:function(a,b,c){var d=this,e=arguments[3];c=c||"*",b=this._toString(b);if(typeof b!="string")throw new Error("messageEvent.js: Error message type!");if(a.postMessage){b="_MESSAGEEVENT_"+b,a.postMessage(b,c);return}var f=this._getIframe(a);f&&(f.id=f.id||"_UUID_"+this._uuid++);var g=this._getFramesName(a);if(!g||/\(|\)/.test(g))throw new Error('messageEvent.js: Iframe "name" property error!');var h={timeStamp:+(new Date),windowName:window.name,targetOrigin:c};try{var i=window.frames[g]._MESSAGEEVENT_;if(i){h.data=b,h.source=window,h.origin=this._getHome(location.href),i(h);return}}catch(j){}e=e||this._getProxy(g,f);if(!e)throw new Error("messageEvent.js: Please specify the proxy path!");var k=document.createElement("iframe");k.name=b,k.style.display="none";var l=function(){d._removeEvent(k,"load",l),k.src="about:blank",k.parentNode.removeChild(k)};this._addEvent(k,"load",l);var m=["#version="+this.version,"&targetName="+g];for(var n in h)h.hasOwnProperty(n)&&m.push("&",n,"=",h[n]);k.src=e+m.join(""),document.getElementsByTagName("head")[0].appendChild(k),k.contentWindow.name=k.name},add:function(a){this._listeners.push(a)},remove:function(a){var b=this._listeners;if(a)for(i=0;i<b.length;i++)a===b[i]&&b.splice(i--,1);else this._listeners=[]},_dispatch:function(a){var b=this._listeners,c;for(var d=0;c=b[d++];)c.call(window,a)},_addEvent:function(a,b,c){var d="addEventListener",e=a[d],f=e?d:"attachEvent",b=e?b:"on"+b;a[f](b,c,!1)},_removeEvent:function(a,b,c){var d="removeEventListener",e=a[d],f=e?d:"detachEvent",b=e?b:"on"+b;a[f](b,c,!1)},_getFramesName:function(a){var b,c=window.frames;try{for(var d in c)c[d]==a&&(b=d)}catch(e){}return b},_getIframe:function(a){var b=document.getElementsByTagName("iframe"),c=b.length;for(var d=0;d<c;d++)if(b[d].contentWindow==a)return b[d]},_getProxy:function(a,b){var c,d="/messageEvent-proxy.html";return this._cache[a]?c=this._cache[a]:b&&(c=this._getHome(b.src),this._cache[a]=c),c&&c+d},_toString:function(a){return typeof a!="string"?window.JSON&&JSON.stringify?"_ISOBJECT_"+JSON.stringify(a):null:a},_toObject:function(a){var b=a.split("_ISOBJECT_")[1];if(b)try{a=JSON.parse(b)}catch(c){}return a},_listeners:[],_getHome:function(a){return a.match(/[A-Za-z]+:\/{0,3}([^\/]+)/)[0]},_cache:{},_uuid:0,_init:function(){var a=this;window.postMessage?a._addEvent(window,"message",function(b){var c=b.data,d=b;if(typeof c!="string")return;c=c.split("_MESSAGEEVENT_")[1];if(!c)return;b={};for(var e in d)b[e]=d[e];b.data=a._toObject(c),a._dispatch(b)}):(window._MESSAGEEVENT_=function(b){var c=b.origin,d=b.windowName,e=b.targetOrigin;if(d){a._cache[d]=c,d==="parent"&&(window.name="_PARENTHOST_"+c);if(b.data==="_NULL_")return}if(e==="*"||e.indexOf(document.URL)===0)b.type="message",b.target=window,b.data=a._toObject(b.data),a._dispatch(b)},a._cache.parent=function(){var b,c="_PARENTHOST_";if(name.indexOf(c)===0)b=name.split(c)[1];else{var d=document.referrer;b=d&&a._getHome(d)}return b&&(window.name=c+b),b}(),window.parent!=window&&a.postMessage(parent,"_NULL_"))}};messageEvent._init();var JSON;JSON||(JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a,b){if(!a||!b)return;a.postMessage=function(a,c,d){b.postMessage.apply(b,arguments)},a.fn.message=function(a){return this.bind("message",a)};var c;a.event.special.message={setup:function(){var e=this;if(this!=window)return!1;c=function(b){var c=new a.Event("message",b);c.data=b.data,d(e,b.data),a.event.trigger(c,null,e)},b.add(c)},teardown:function(){if(this!=window)return!1;b.remove(c)}};var d=function(b,c){var d=a.data(b,"events"),e=d&&d.message;e&&a.each(e,function(a,b){b.data=c})}}(this.jQuery,this.messageEvent)